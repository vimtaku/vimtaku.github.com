
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>vimtaku blog</title>
	<meta name="author" content="vimtaku">

	
	<meta name="description" content="土日振り返り
雪うざい。地味に perfect ruby を進めた。
ruby 力が2くらい上がった。気がする。 勉強途中経過 進んでない rails tutorial 6 までやった 読書途中経過 進んだ パーフェクトルビー15章まで読んだ 手を動かしながら ver 積んでる &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="vimtaku blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="http://vimtakublog.qolwu.com/favicon.ico" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">vimtaku blog</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:vimtaku.github.io">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/vimtaku" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/vimtaku" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:vimtaku.github.io">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/02/09/life-feb-9/">
		
			2014/2/9</a>
	</h2>
	<div class="entry-content">
		
<h2 id="section">土日振り返り</h2>
<p>雪うざい。地味に perfect ruby を進めた。<br />
ruby 力が2くらい上がった。気がする。  </p>

<h2 id="section-1">勉強途中経過</h2>

<h3 id="section-2">進んでない</h3>
<ul>
  <li>rails tutorial 6 までやった</li>
</ul>

<h2 id="section-3">読書途中経過</h2>

<h3 id="section-4">進んだ</h3>
<ul>
  <li>パーフェクトルビー15章まで読んだ
    <ul>
      <li>手を動かしながら ver</li>
    </ul>
  </li>
</ul>

<h3 id="section-5">積んでる</h3>
<ul>
  <li>詳解UNIXプログラミング第7章まで読んだ</li>
  <li>オペレーティングシステム 6章まで読んだ</li>
  <li>Webエンジニアのためのデータベース技術［実践］入門 7章まで読んだ</li>
  <li>ネットワークはなぜつながるのか?</li>
  <li>chef-solo 入門 #23 まで読んだ(どっかで手を動かしながらやる)</li>
</ul>

<h3 id="section-6">読み終えた</h3>
<ul>
  <li>(2014/2/8)プログラマの数学</li>
  <li>(2014/2/6)(一周目、さらっと)[改訂新版] Apache Solr入門 ~オープンソース全文検索エンジン</li>
  <li>(2014/1/26)マスタリングTCP/IP 入門第5版 とりあえず読み切った</li>
  <li>(2014/1/13)読む筋トレ</li>
  <li>(2014/1/8)ザ・コーチ 最高の自分に出会える「目標の達人ノート」</li>
</ul>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-02-09T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>life</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/02/08/life-feb-8/">
		
			2月の Solr には雪も Full</a>
	</h2>
	<div class="entry-content">
		
<h2 id="section">先週の振り返り</h2>
<p>先週は solr 祭りだった。<br />
solr は存在くらいしか知らなかったけど、非常によく出来たソフトウェアで<br />
これを使いこなせれば(使い方を知っていれば)非常によい価値を<br />
提供できる気がした。  </p>

<p>先々週はあんまり何やったか覚えていない。<br />
そういや 先週は docker とかめっちゃいいなと思ってたところだった。<br />
あとで触ってみよう。  </p>

<p>ところで東京のくせに雪とか降るのは生意気だと思う(北から目線。  </p>

<h2 id="section-1">勉強途中経過</h2>

<h3 id="section-2">進んでない</h3>
<ul>
  <li>rails tutorial 6 までやった</li>
</ul>

<h2 id="section-3">読書途中経過</h2>

<h3 id="section-4">進んだ</h3>
<ul>
  <li>詳解UNIXプログラミング第7章まで読んだ</li>
  <li>パーフェクトルビー10章まで読んだ
    <ul>
      <li>手を動かしながら ver</li>
    </ul>
  </li>
</ul>

<h3 id="section-5">積んでる</h3>
<ul>
  <li>オペレーティングシステム 6章まで読んだ</li>
  <li>Webエンジニアのためのデータベース技術［実践］入門 7章まで読んだ</li>
  <li>ネットワークはなぜつながるのか?</li>
  <li>chef-solo 入門 #23 まで読んだ(どっかで手を動かしながらやる)</li>
</ul>

<h3 id="section-6">読み終えた</h3>
<ul>
  <li>(2014/2/8)プログラマの数学</li>
  <li>(2014/2/6)(一周目、さらっと)[改訂新版] Apache Solr入門 ~オープンソース全文検索エンジン</li>
  <li>(2014/1/26)マスタリングTCP/IP 入門第5版 とりあえず読み切った</li>
  <li>(2014/1/13)読む筋トレ</li>
  <li>(2014/1/8)ザ・コーチ 最高の自分に出会える「目標の達人ノート」</li>
</ul>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-02-08T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>life</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/02/08/ichiro/">
		
			イチロー</a>
	</h2>
	<div class="entry-content">
		
<h2 id="section">名言</h2>

<h3 id="by-">小さいことを積み重ねるのが、とんでもないところへ行くただひとつの道だと思っています。(by イチロー)</h3>

<p>はい、がんばりましょう。</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-02-08T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/ming-yan/'>名言</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/02/02/what-is-docker/">
		
			Docker の概要をしらべて触ってみた</a>
	</h2>
	<div class="entry-content">
		
<h2 id="toc">TOC</h2>
<ul id="markdown-toc">
  <li><a href="#toc">TOC</a></li>
  <li><a href="#section">はじめに</a></li>
  <li><a href="#docker-">docker とは</a></li>
  <li><a href="#lxc-">LXC とは</a></li>
  <li><a href="#aufs-union-fs-">aufs, Union FS とは</a>    <ul>
      <li><a href="#union-mount">union mount</a></li>
      <li><a href="#section-1">読み込み</a></li>
      <li><a href="#section-2">書き込み</a></li>
      <li><a href="#section-3">削除</a></li>
    </ul>
  </li>
  <li><a href="#github-">github 的な要素</a>    <ul>
      <li><a href="#section-4">出来上がりイメージ</a></li>
    </ul>
  </li>
  <li><a href="#section-5">所感</a></li>
  <li><a href="#section-6">参考文献</a></li>
</ul>

<h2 id="section">はじめに</h2>
<p>この記事では Docker について自分なりに理解するために調べたことをまとめる。<br />
Docker の tutorial は command line を ブラウザで実際に叩くところまでできるようになっているので、<br />
非常にわかりやすく入門できる。なので、 tutorial に関してはそっちをやったほうが良い。<br />
この記事は Docker ってこんな感じのやつなんだーってのが伝わればばいいなと思う。<br />
(ちなみに まだ Docker 歴は1日)</p>

<h2 id="docker-">docker とは</h2>
<p>LXC と aufs と github のようなものをうまくくみ合わせて提供される<br />
仮想化ソフトウェアだ。  </p>

<h2 id="lxc-">LXC とは</h2>
<p>Linux Container のこと。  </p>

<p><a href="http://gihyo.jp/admin/column/01/vm/2011/lxc_container">http://gihyo.jp/admin/column/01/vm/2011/lxc_container</a>によれば、  </p>
<blockquote><p>LXCの基本技術となるのが「コンテナ」と呼ばれる一種のリソース管理システムです。ファイルシステムの他，ホスト名やプロセス，ネットワークソケットなどのカーネルが扱うさまざまなリソースの管理テーブルを個々に用意し，これをコンテナごとに管理することで，コンテナごとに独立したOSのように動作させることができます。</p></blockquote>
<p>とある。<br />
また、カーネルの機能である <a href="http://ja.wikipedia.org/wiki/Cgroups">Cgroups</a> の説明をみれば非常によく理解できた。  </p>

<h2 id="aufs-union-fs-">aufs, Union FS とは</h2>
<p>ここに、 Union mount と Union type file system の資料がある。<br />
非常にわかりやすい説明だった。ここに、 aufs の説明もある。結構古いけど。。<br />
<a href="http://www.oreilly.co.jp/community/blog/2010/02/union-mount-uniontype-fs-part-1.html">http://www.oreilly.co.jp/community/blog/2010/02/union-mount-uniontype-fs-part-1.html</a>
ちょっとだけ簡単に自分用にまとめる。  </p>

<h3 id="union-mount">union mount</h3>
<p>filesystem A と filesystem B をマウントして、それぞれが file A, file B を同じディレクトリで持っていたとすると、<br />
union mount をつかったとき、fileA, file B の両方のファイルが見える。  </p>

<h3 id="section-1">読み込み</h3>
<p>open システムコールとかを通して呼ぶと、 union 機能が上から順に読んでいけば、差分的に一番新しいものを読める。<br />
両方のファイルシステムが fileA を持っていて、その内容がちがう場合、filesystem の mount の優先度(レイヤー順?)で<br />
どちらの filesystem の fileA が見えるか変わるんだと思う。  </p>

<h3 id="section-2">書き込み</h3>
<p>なんらかを書き込んで差分ができたとき、 上位ディスクとは違うものを保証しなければならないため、<br />
上位ディスクのものをコピーして書き込む。だからコピーオンライト。<br />
でもこの場合は、 copy-up と呼ばれて、プロセス fork でいうそれとは区別されている模様。  </p>

<h3 id="section-3">削除</h3>
<p>ファイルが削除されても、上位ディスクには存在しているため、事実上削除ができない。<br />
なので 特別なファイルを作成することで 消えたように見せる。(DB で言う論理削除みたいなもんだと認識)<br />
whiteout という。  </p>

<h2 id="github-">github 的な要素</h2>
<p><a href="https://index.docker.io">index.docker.io</a> レポジトリに image を push できる。<br />
memcached を <a href="https://www.docker.io/learn/dockerfile/">Dockerfile によって image を作る tutorial</a> があるので、それをやった。<br />
それでできた Dockerfile  を使って repository に push した例を以下に示す。<br />
ちなみに、 <a href="https://index.docker.io/account/">https://index.docker.io/account/</a> にあらかじめ登録しておいた。  </p>

<div>
  <pre><code class="bash">vagrant@ubuntu-12:~$ docker login
Username: vimtaku
Password:
Email: ******@gmail.com
Login Succeeded

vagrant@ubuntu-12:~$ docker build -t vimtaku/memcached_sample - &lt; Dockerfile

vagrant@ubuntu-12:~$ docker images
REPOSITORY                 TAG                 IMAGE ID            CREATED             VIRTUAL SIZE
vimtaku/memcached_sample   latest              242bd405025e        22 seconds ago      217.1 MB
run_memcached              latest              5f1cda03f61c        17 hours ago        217.1 MB
memcached                  latest              9166d484dda8        17 hours ago        217.1 MB
brand_new_memcached        latest              7bdd82d0abf7        20 hours ago        217.1 MB
memcached_new              latest              c18168a45363        20 hours ago        245.5 MB
ubuntu                     12.10               426130da57f7        7 days ago          127.6 MB
ubuntu                     quantal             426130da57f7        7 days ago          127.6 MB
ubuntu                     10.04               8589d4e9c7c6        7 days ago          139.6 MB
ubuntu                     lucid               8589d4e9c7c6        7 days ago          139.6 MB
ubuntu                     12.04               72e10143e54a        7 days ago          125.9 MB
ubuntu                     latest              72e10143e54a        7 days ago          125.9 MB
ubuntu                     precise             72e10143e54a        7 days ago          125.9 MB
ubuntu                     13.10               721f07d19f96        7 days ago          144.6 MB
ubuntu                     saucy               721f07d19f96        7 days ago          144.6 MB
ubuntu                     13.04               476aa49de636        7 days ago          133.6 MB
ubuntu                     raring              476aa49de636        7 days ago          133.6 MB

vagrant@ubuntu-12:~$ docker push vimtaku/memcached_sample
The push refers to a repository [vimtaku/memcached_sample] (len: 1)
Sending image list
Pushing repository vimtaku/memcached_sample (1 tags)
511136ea3c5a: Image already pushed, skipping 
b74728ce6435: Image already pushed, skipping 
72e10143e54a: Image already pushed, skipping 
28d8e9cef54f: Image successfully pushed 
6be17bb13216: Image successfully pushed 
1b910f3ee9b7: Image successfully pushed 
18e04c08eb9b: Image successfully pushed 
2e32ba041afa: Image successfully pushed 
1cf353d00dd8: Image successfully pushed 
242bd405025e: Image successfully pushed 
Pushing tags for rev [242bd405025e] on {https://registry-1.docker.io/v1/repositories/vimtaku/memcached_sample/tags/latest}</code></pre>
</div>

<p><br /></p>

<h3 id="section-4">出来上がりイメージ</h3>
<p><img src="http://gyazo.com/6a99a7bdffa6ce80369dad852461aacb.png" style="width:100%;" /></p>

<h2 id="section-5">所感</h2>
<p>この記事では、 docker の一番の利点だと感じている、 image を簡単に作って試す、みたいな部分は書いていない。<br />
すごい早さで image を作り出すことができるのには感動した。そこが一番の利点だと思う。<br />
あと、<a href="http://www.oreilly.co.jp/community/blog/2010/02/union-mount-uniontype-fs-part-1.html">この oreilly の資料</a>は 3回くらい読む価値はありそうだ。  </p>

<h2 id="section-6">参考文献</h2>
<p><a href="http://ja.wikipedia.org/wiki/LXC">http://ja.wikipedia.org/wiki/LXC</a><br />
<a href="http://gihyo.jp/admin/column/01/vm/2011/lxc_container">http://gihyo.jp/admin/column/01/vm/2011/lxc_container</a><br />
<a href="http://ja.wikipedia.org/wiki/Cgroups">http://ja.wikipedia.org/wiki/Cgroups</a><br />
<a href="http://www.oreilly.co.jp/community/blog/2010/02/union-mount-uniontype-fs-part-1.html">http://www.oreilly.co.jp/community/blog/2010/02/union-mount-uniontype-fs-part-1.html</a><br />
<a href="http://teppeis.hatenablog.com/entry/docker">http://teppeis.hatenablog.com/entry/docker</a><br />
<a href="http://shibayu36.hatenablog.com/entry/2013/12/30/173949">http://shibayu36.hatenablog.com/entry/2013/12/30/173949</a><br />
<a href="http://2013.8-p.info/japanese/06-22-docker.html">http://2013.8-p.info/japanese/06-22-docker.html</a>  </p>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-02-02T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/docker/'>docker</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/27/chef-memo-2/">
		
			Chef についてのメモ2</a>
	</h2>
	<div class="entry-content">
		
<h2 id="chef--libraries-">chef の libraries を使う場合の今のところの俺の結論</h2>

<p>以下に述べる、 1 の方法を使う。  </p>

<p>とはいえ一長一短な気がするからどっちがいいって言えない。<br />
ちなみに libraries から node はみたいよね、っていう前提。<br />
あと、自分の環境(chef-solo, v11.8.2)にもよるかも。まぁ参考程度に。<br />
もっといい方法あったら教えて下さい。<br />
(っていうか意外に chef (libraries)のドキュメントって少ない気がする..)  </p>

<h2 id="libraries-">libraries を使う方法</h2>
<ol>
  <li>class MyClass みたいなクラスを定義して、 new するときに node 渡すようにして、あとは好きに使うパターン</li>
  <li>module MyModule みたいなモジュールを定義して、extend してから、わかりやすいメソッドを呼び出して使うパターン</li>
</ol>

<h2 id="section">1. のメリット、デメリット</h2>

<h3 id="section-1">メリット</h3>
<ul>
  <li>呼びたいメソッドを MyClass.method とかけるから、コードが読みやすいのではないだろうかということ。</li>
</ul>

<h3 id="section-2">デメリット</h3>
<ul>
  <li>他のレシピからでも MyClass が使える</li>
</ul>

<h2 id="section-3">2. のメリット、デメリット</h2>

<h3 id="section-4">メリット</h3>
<ul>
  <li>名前空間を汚染しない</li>
</ul>

<h3 id="section-5">デメリット</h3>
<ul>
  <li>いちいち呼びたい recipe で extend とか書かなきゃいけない</li>
  <li>呼び出すときに method_name だけしかないからちょっと読みにくいかも、と思った。 ruby ってそういうもん？</li>
</ul>

<h2 id="section-6">以下駄文メモ</h2>

<ul>
  <li>class をつかう場合、 名前空間を切って使用すると node が見えないので不便
    <ul>
      <li>class Chef::Recipe にメソッドをはやして node を使えば見れる</li>
      <li>class Chef::Recipe::Hoge からは node はみえない
        <ul>
          <li>そんならChef::Recipe::Hoge みたいなインスタンスを new するときに node 渡して使えばいいんじゃね?</li>
          <li>まぁできんことはない</li>
        </ul>
      </li>
      <li>class Chef::Recipe にメソッド生やすのとかは Recipe が汚れるからやらない方がいい</li>
      <li>単純に class MyClass みたいなやつを new してそれを使うのが吉かも</li>
      <li>でも libraries に定義しているから他のレシピから使われる可能性があって、閉じたい人的にはアレ</li>
    </ul>
  </li>
  <li>module をつかう場合
    <ul>
      <li>extend Module名 を使えば、 node は見えるし、使う場所が限られる
        <ul>
          <li>いちいち extend するのはめんどい</li>
          <li>呼び出すとき method 名 だけになるからそれが許容できるならそれでもいいかも</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="section-7">関連記事</h2>
<p><a href="http://vimtaku.github.io/chef/2014/01/24/chef-memo/">http://vimtaku.github.io/chef/2014/01/24/chef-memo/</a></p>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-27T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/chef/'>chef</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/26/life-jan-last/">
		
			一月ももう終わりそう</a>
	</h2>
	<div class="entry-content">
		
<h2 id="section">先週の振り返り</h2>
<p>先週は chef と格闘しっぱなしだった。<br />
まぁでも opsworks についての理解もかなり深まったし、<br />
chef の感覚はものすごくつかめたのでよかった。<br />
自分でも新しい recipe 複数かいたし。<br />
でもなんだか仕事が忙しかった気がする。<br />
あと、ブログのアウトプットも増えてきた。<br />
だれに読まれようが関係ない気持ちで書くと案外かけるもんだ。<br />
まぁ, Jekyll で書けるってのがかなり大きいんだけれども。  </p>

<p>あ、あと ruby 書くために整理したかったので .vimrc を一新した。<br />
そして今流行の homesick を使うようにした。<br />
各環境で .zshrc とか違っている感があるので、徐々に改善していく。  </p>

<h2 id="section-1">勉強途中経過</h2>

<h3 id="section-2">進んだ</h3>
<ul>
  <li>rails tutorial 6 までやった</li>
</ul>

<h2 id="section-3">読書途中経過</h2>

<h3 id="section-4">進んだ</h3>
<ul>
  <li>詳解UNIXプログラミング第6章まで読んだ</li>
  <li>プログラマの数学 4章まで読んだ</li>
  <li>パーフェクトルビー5章まで読んだ
    <ul>
      <li>手を動かしながら ver</li>
    </ul>
  </li>
</ul>

<h3 id="section-5">積んでる</h3>
<ul>
  <li>オペレーティングシステム 6章まで読んだ</li>
  <li>Webエンジニアのためのデータベース技術［実践］入門 7章まで読んだ</li>
  <li>ネットワークはなぜつながるのか?</li>
  <li>chef-solo 入門 #23 まで読んだ(どっかで手を動かしながらやる)</li>
</ul>

<h3 id="section-6">読み終えた</h3>
<ul>
  <li>(2014/1/26)マスタリングTCP/IP 入門第5版 とりあえず読み切った</li>
  <li>(2014/1/13)読む筋トレ</li>
  <li>(2014/1/8)ザ・コーチ 最高の自分に出会える「目標の達人ノート」</li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-26T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/life/'>life</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/24/chef-memo/">
		
			Chef についてのメモ</a>
	</h2>
	<div class="entry-content">
		
<h2 id="section">概要</h2>
<p>chef について、現時点でわかっている、知っておいたら役立ちそうなメモを書いておく。
いわゆる実際ソース追えばわかるんだけど、まだソース追ってないので段階での現在わかっている挙動まとめ。  </p>

<h2 id="attribute-">attribute の読み込み順について</h2>
<ul>
  <li>attributes/default.rb が一番最初に読み込まれる</li>
  <li>attributes/hoge.rb などの、attributes ディレクトリの他のファイルが辞書順に読み込まれる</li>
  <li>node の値は各ファイルで上書きをすることができる  </li>
</ul>

<h2 id="libraries-">libraries について</h2>
<ul>
  <li>libraries/hoge.rb などに、 Chef::Recipe::Hoge などのクラスを定義して、recipe から呼び出すことができる。
    <ul>
      <li>Hoge.fuga_method として recipe から使用可能。</li>
    </ul>
  </li>
  <li>他のレシピを同時に実行するときでも、Hoge.fuga_method は使用可能。</li>
  <li>libraries/mymodule.rb などに、 module MyModule などのモジュールを定義して、 recipe から呼び出すことができる。
    <ul>
      <li>自分がイマ実行しているレシピのみでモジュールを使用したい場合は、レシピに extend MyModule して特異メソッドとしてメソッドを生やす。</li>
      <li>他のレシピでもモジュールを使用したい場合は、::Chef::Recipe.send(:include, MyModule) として Chef::Recipe クラスに include することで、my_module_method を呼び出せる。</li>
    </ul>
  </li>
</ul>

<h2 id="chef-">chef 実行時のレシピについて</h2>
<ul>
  <li>各レシピ、例えば first, second っていうレシピがあったとすると、それらは Chef::Recipe インスタンスである。
    <ul>
      <li>chef 実行時に self をみればわかる</li>
    </ul>
  </li>
</ul>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-24T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/chef/'>chef</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/21/fog-iam-profile/">
		
			Fog っていう Gem で Use_iam_profile があんまうまく行かない件</a>
	</h2>
	<div class="entry-content">
		
<h2 id="section">現象</h2>
<p>iam_profile を使うことで、 aws_access_key や aws_access_secret を具体的に指定しなくても、<br />
metadata な endpoint にアクセスして一時的な access_key と secret を取得できるようになっている(できたのは割と最近らしい)。<br />
それなら、iam を使いたいわけなんだけど、 fog v1.18.0 と v1.19.0 で試しても use_iam_profile がうまくいかない。  </p>

<p>呼び出しているクライアントライブラリは asset_sync v1.0.0 と elasticsearch v0.3.4 。<br />
どちらも aws_credential fetcher で credential を取得してるみたいだけど、それを使ってないようにみえた。  </p>

<h2 id="section-1">対処</h2>
<p>全部読んでないからわからないけど、俺の予想が合っていれば<br />
credential を撮ってきたものを使用していないので ここが怪しかった。  </p>

<p>lib/fog/core/service.rb</p>
<div>
  <pre><code class="bash">-options = options.merge(fetch_credentials(options))
+options = fetch_credentials(options).merge(options)</code></pre>
</div>

<p>とりあえずもっと調べなきゃよくわからない。<br />
これがうまくいっていそうなら pull req だしてみよう。  </p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-21T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/aws/'>aws</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/20/cloud-watch-alarm/">
		
			Chef で Opsworks のインスタンス起動時に Cloudwatch の Alarm を作成するためにしたこと</a>
	</h2>
	<div class="entry-content">
		
<h2 id="toc">TOC</h2>
<ul id="markdown-toc">
  <li><a href="#toc">TOC</a></li>
  <li><a href="#section">大まかな流れ</a></li>
  <li><a href="#iam-">1. IAM の設定</a></li>
  <li><a href="#sns-">2. SNS のトピックの作成</a></li>
  <li><a href="#cloud-watch--api--cli-">3. cloud watch の API を cli から叩いてみる</a>    <ul>
      <li><a href="#from-cli">メトリックの作成 from cli</a></li>
    </ul>
  </li>
  <li><a href="#cloud-watch-">4. cloud watch での作成確認</a></li>
  <li><a href="#chef-recipe-">5. chef recipe を書く</a></li>
  <li><a href="#opsworks--setup-">6. opsworks のレイヤー設定で、 setup ライフサイクルイベントで設定</a>    <ul>
      <li><a href="#section-1">おまけ</a>        <ul>
          <li><a href="#section-2">気をつけること要点</a></li>
          <li><a href="#section-3">標準出力から入力をし続けるからメモリに確保し続けるコマンド</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="section">大まかな流れ</h2>
<ol>
  <li>IAM の設定</li>
  <li>SNS のトピックの作成(メール送る用)</li>
  <li>cloud watch の API を cli から叩いてみる</li>
  <li>cloud watch の手動確認</li>
  <li>chef recipe を書く</li>
  <li>opsworks のレイヤー設定で、 setup ライフサイクルイベントで設定</li>
</ol>

<p>ではさっそく。  </p>

<h2 id="iam-">1. IAM の設定</h2>
<p>opsworks ではインスタンス生成時に デフォルトで Default IAM instance profile を設定できる。<br />
ここの IAM Role に権限がないと、 aws cli から操作ができないので注意する。
この記事では、IAMの設定については詳細に明記しない。  </p>

<h2 id="sns-">2. SNS のトピックの作成</h2>
<p>コマンドラインか AWS Console から、メール送る用に トピックを作成する。<br />
監視しているインスタンスの異常時にメールを受け取るため。<br />
CLI ではこちらが参考になる。<br />
<a href="http://exploreaws.doorblog.jp/archives/24701093.html">http://exploreaws.doorblog.jp/archives/24701093.html</a><br />
サブスクリプションを許可しておくと後々のチェックで捗る。<br />
ちなみにこれは、あとで alarm-actions に指定する。  </p>

<p>ここではできた topic が、仮に arn:aws:sns:ap-northeast-1:99999999:mogemoga としておく。  </p>

<h2 id="cloud-watch--api--cli-">3. cloud watch の API を cli から叩いてみる</h2>

<h3 id="from-cli">メトリックの作成 from cli</h3>

<div>
  <pre><code class="bash">aws cloudwatch put-metric-alarm
--alarm-name=&#39;disk-usage&#39; \
             --alarm-description &#39;Disk usage alert&#39; \
             --alarm-actions=&#39;arn:aws:sns:ap-northeast-1:99999999:mogemoga&#39;   \
             --namespace  &#39;System/Linux&#39;  \
             --metric-name  &#39;DiskSpaceUtilization&#39;   \
             --dimensions=&#39;[{&quot;Name&quot;: &quot;InstanceId&quot;,&quot;Value&quot;: &quot;i-deadbeaf&quot;},{&quot;Name&quot;:&quot;Filesystem&quot;,&quot;Value&quot;: &quot;/dev/xvda1&quot;},{&quot;Name&quot;:&quot;MountPath&quot;,&quot;Value&quot;:&quot;/&quot;}]&#39; \
             --statistic  &#39;Average&#39; \
             --period  &#39;300&#39;   \
             --unit &#39;Percent&#39;
             --threshold  &#39;50&#39;
             --evaluation-periods  &#39;1&#39;
             --region &#39;ap-northeast-1&#39;
             --comparison-operator &#39;GreaterThanOrEqualToThreshold&#39;</code></pre>
</div>

<p>ここですんなりうまくいくかどうかが別れると思う。<br />
IAM role を使う場合は、権限が許可されていれば問題なく通ると思う。<br />
権限がない場合は、 cli の credential 設定が必要になるかもしれない。<br />
<a href="http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/SettingUp_CommandLine.html">http://docs.aws.amazon.com/ja_jp/AWSEC2/latest/UserGuide/SettingUp_CommandLine.html</a>  </p>

<h2 id="cloud-watch-">4. cloud watch での作成確認</h2>
<p>上記のコマンドで成功していれば AWS Console から cloud watch のアラームができているはずなので確認する。  </p>

<h2 id="chef-recipe-">5. chef recipe を書く</h2>

<p>あとは、上記 3 を実行する chef のレシピを書いて、 opsworks が取ってくる custom chef recipe のレポジトリに配置すればおｋ．<br />
今回は load average もとりたかったので、<br />
<a href="http://aws.amazon.com/code/8720044071969977">http://aws.amazon.com/code/8720044071969977</a><br />
のスクリプトを改変して使用することにした。<br />
ソースはこちら -&gt; <a href="https://github.com/FumihikoSHIROYAMA/cloud_watch_script.git">https://github.com/FumihikoSHIROYAMA/cloud_watch_script.git</a><br />
disk space をとったりすることができる pl なのですごく便利。  </p>

<p>下記の repository は crontab に 上記の pl (load average は別) のものを登録するものだ。<br />
<a href="https://github.com/alexism/cloudwatch_monitoring">https://github.com/alexism/cloudwatch_monitoring</a>  </p>

<p>これをフォークして、 load average とれる cron を作る機能と、 アラーム登録する奴を書いた。<br />
<a href="https://github.com/vimtaku/cloudwatch_monitoring.git">https://github.com/vimtaku/cloudwatch_monitoring.git</a><br />
chef 力低めで申し訳なので、アドバイス、pull req など大歓迎。  </p>

<h2 id="opsworks--setup-">6. opsworks のレイヤー設定で、 setup ライフサイクルイベントで設定</h2>
<p>これはもう、 opsworks に慣れているひとなら問題無いと思う。<br />
5 で作ったものがうまくいっていれば(というか試すときに deploy かどっかで試すと思うんだけど)<br />
それを setup に移動してやるだけだ。  </p>

<h3 id="section-1">おまけ</h3>

<h4 id="section-2">気をつけること要点</h4>
<ul>
  <li>IAM Role に権限がない場合があるので気をつける
    <ul>
      <li>参考
        <ul>
          <li><a href="http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/UsingIAM.html">http://docs.aws.amazon.com/AmazonCloudWatch/latest/DeveloperGuide/UsingIAM.html</a></li>
          <li><a href="http://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-CreateVolume.html">http://docs.aws.amazon.com/AWSEC2/latest/APIReference/ApiReference-query-CreateVolume.html</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>opsworks では chef の data_bags が使えないのを頭に入れておく
    <ul>
      <li>自分はあとから気づいたパターン
        <ul>
          <li>詳細は <a href="http://docs.aws.amazon.com/opsworks/latest/userguide/workingcookbook-chef11.html">http://docs.aws.amazon.com/opsworks/latest/userguide/workingcookbook-chef11.html</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li>mon-put-metric-alarm の代わりに aws cloudwatch put-metric-aaerm を使用する
    <ul>
      <li>role の設定ができていても credential エラーとかいっぱい言われるため。</li>
    </ul>
  </li>
  <li>alert と alarm が似ているので alerm ってタイポに気をつける</li>
</ul>

<h4 id="section-3">標準出力から入力をし続けるからメモリに確保し続けるコマンド</h4>
<div>
  <pre><code class="bash">/dev/null &lt; $(yes)
cat - &lt; $(yes)</code></pre>
</div>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-20T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/aws/'>aws</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2014/01/19/jisui-best-practice/">
		
			俺なりの自炊セットをそろえた</a>
	</h2>
	<div class="entry-content">
		
<h2 id="section">背景</h2>
<p>覚悟を決めたので自炊セットを買うことにした。<br />
電子書籍は最近出てくることが多くなったとはいえ、<br />
すべてが電子書籍で販売されている訳ではないからだ。<br />
Nexus7 を存分に生かすために買った自炊セットの<br />
俺なりのベストプラクティスをここに記載する。  </p>

<p>とはいえ、家にある本の数は100冊程度なので、<br />
もしかしたら裁断サービスのほうが安く上がるかもしれないが<br />
安値で自炊セットをそろえれば、家の雑多な書類とかも処理できるし<br />
楽なのでそろえることにした。  </p>

<p>とにかく安くそろえることを前提とした。</p>

<h2 id="section-1">俺なりの結論</h2>
<ul>
  <li>スキャナ
    <ul>
      <li>image FORMULA DR-C125</li>
    </ul>
  </li>
  <li>裁断機
    <ul>
      <li>カール事務器 ディスクカッターA4サイズ対応 丸刃40枚裁断(2往復) ブラック DC-210N</li>
    </ul>
  </li>
</ul>

<p>計、約3万円也。。</p>

<h2 id="section-2">スキャナの選定</h2>
<p>スキャナは実際すごくまよったが、とにかく安くそろえたかったので、<br />
ScanSnap1500 の中古か image FORMULA DR-C125 にしようと思っていた。<br />
結構比較記事があるので、ググってもらえばわかると思うけど、<br />
SS1500は重送とかが結構おこるといわれていたのと、Amazon のレビューの評判が<br />
そこそこよさげだったので、 image FORMULA DR-C125 にした。<br />
安さの観点から、比較対象として SS1300 とか、ハンディスキャナとかがあったけど<br />
SS1500 とのスキャンスピード比較動画が結構えげつない差だったので SS1300 はやめた。<br />
ちなみに、 SS1500 よりも DR-C125 のほうが早い感じらしい。<br />
ScanSnap1500 マジ良いみたいな話で、実際に使ったこと無いから比較できないけど、<br />
DR-C125 はとても良いものだった。ちなみにヤフオクで 約2万円で中古を買った。<br />
なんていうか、Mac 用のドライバを普通にインストールして、<br />
すぐにスキャンできた。OCR も効いている。<br />
新品も Amazon で2.7万くらいなので、新品でも良いかもしれない。<br />
アフィは張らない。  </p>

<h2 id="section-3">裁断機の選定</h2>
<p>ローラーカッター(1000円)とカッターマット、定規で行けるかと思っていたんだけど、<br />
分厚い本とか、マジ無理です。絶対無理。<br />
いや、無理ではない、正確には。<br />
でも、自炊とか効率的なことを考える人がやることではない。<br />
カッターでもいい人は、新書とかばかりのひと。<br />
それなら余裕。技術書はたぶん相当に厳しい。<br />
なので、ちょうど今さっき、評判が割と良い DC-210N の裁断機を買った。<br />
約1万円也。<br />
どうなるかわからないが、絶対手動よりはマシだと思う。<br />
それくらい、非現実的だと思う。行けると思っていた俺浅はか。  </p>

<h2 id="section-4">あとは読むだけ</h2>
<p>自炊しっぱなしで読まないみたいなのがありそうだけど、必ず読むよ。<br />
学習し続けることは、尊い。<br />
たゆまぬ努力を続けよう。</p>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2014-01-19T00:00:00+09:00" pubdate data-updated="true"></time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/zi-chui/'>自炊</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/7/" class="prev">Prev</a>
    
    
        <a href="/blog/page/9/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2016

    vimtaku

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->




	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-30103097-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>